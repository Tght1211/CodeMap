<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta charset="utf-8">
    <style>
        /* æ–°å¢æ ·å¼ï¼Œç”¨äºè®¾ç½®é€‰ä¸­çŠ¶æ€çš„èƒŒæ™¯é¢œè‰² */
        #fileList li.selected {
            background-color: #ff657d; /* é»˜è®¤é€‰ä¸­çŠ¶æ€çš„èƒŒæ™¯é¢œè‰² */
            color: #ffffff; /* é»˜è®¤é€‰ä¸­çŠ¶æ€çš„æ–‡å­—é¢œè‰² */
        }

        /* æ–°å¢æ ·å¼ï¼Œç”¨äºç¾åŒ–æœç´¢æ¡† */
        #searchInput {
            margin: 10px;
            padding: 8px;
            width: 80%;
            font-size: 14px;
            border: 1px solid #555;
            border-radius: 4px;
        }

        /* ç§»é™¤liæ ‡ç­¾å‰é¢çš„å°åœ†ç‚¹ */
        #fileList li {
            list-style-type: none;
            margin: 10px;
            padding: 10px;
        }

        /* æ·»åŠ æ ·å¼ï¼Œä½¿æ»šåŠ¨æ¡éšè— */
        ::-webkit-scrollbar {
            display: none;
        }

        #leftPanel {
            overflow: hidden;
            background: #0f011d;
            color: chartreuse;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Ensure flex items can shrink past their content */
            position: relative;
        }

        #leftPanelInner {
            flex-grow: 1; /* Allow the inner container to grow and fill the available space */
            overflow-y: auto;
        }

        #container {
            flex-grow: 1;
            background: #15012b;
        }

        /* æ·»åŠ æ ·å¼ï¼Œä½¿å·¦ä¾§åˆ—è¡¨å’Œå³ä¾§å®¹å™¨ä¹‹é—´æœ‰ä¸€ä¸ªæ‹–åŠ¨æ¡ */
        #dragBar {
            cursor: ew-resize;
            width: 8px;
            background: #333;
            height: 100%;
            position: absolute;
            right: 0;
            top: 0;
        }

        .tapInfo {
            width: 300px;
            margin-left: 10px;
            padding: 10px;
            color: white;
        }

        /* é‡æ–°å®šä¹‰ä¸‹æ‹‰æ¡†æ ·å¼ */
        #projectDropdown {
            background-color: #0f011d; /* èƒŒæ™¯é¢œè‰² */
            color: #ffa500; /* æ–‡å­—é¢œè‰² */
            font-size: 16px !important; /* æ–‡å­—å¤§å° */
            border: 1px solid #555; /* è¾¹æ¡†æ ·å¼ */
            border-radius: 4px; /* è¾¹æ¡†åœ†è§’ */
            margin-left: 20px !important;
            width: 70%;
        }

        /* é¼ æ ‡æ‚¬åœæ—¶çš„æ ·å¼ */
        #projectDropdown:hover {
            background-color: #1a001f;
        }

        /* ä¸‹æ‹‰æ¡†ä¸­çš„é€‰é¡¹æ ·å¼ */
        #projectDropdown option {
            background-color: #0f011d; /* èƒŒæ™¯é¢œè‰² */
            color: #ffa500; /* æ–‡å­—é¢œè‰² */
            font-size: 16px; /* æ–‡å­—å¤§å° */
        }

        /* æ–°å¢æ ·å¼ï¼Œç”¨äºç¾åŒ–è®¾ç½®å¼¹çª— */
        #settingsModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 300px;
            background-color: #2e2e2e; /* è®¾ç½®å¼¹çª—èƒŒæ™¯é¢œè‰² */
            border: 1px solid #555;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            color: white; /* è®¾ç½®å¼¹çª—æ–‡å­—é¢œè‰² */
        }

        /* æ–°å¢æ ·å¼ï¼Œç”¨äºç¾åŒ–è®¾ç½®å¼¹çª—ä¸­çš„æ§ä»¶ */
        #settingsModal label {
            display: block;
            margin: 10px 0;
        }

        #settingsModal input {
            padding: 8px;
            font-size: 14px;
            border: 1px solid #555;
            border-radius: 4px;
            width: 100%;
        }

        #settingsModal button {
            padding: 8px;
            font-size: 14px;
            background-color: #4caf50; /* è®¾ç½®æŒ‰é’®èƒŒæ™¯é¢œè‰² */
            color: white; /* è®¾ç½®æŒ‰é’®æ–‡å­—é¢œè‰² */
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #settingsModal button:hover {
            background-color: #45a049; /* é¼ æ ‡æ‚¬åœæ—¶çš„æŒ‰é’®èƒŒæ™¯é¢œè‰² */
        }
    </style>
</head>

<body style="height: 100%; margin: 0;padding: 0">
<div style="display:flex; height: 100vh; width: 100%">
    <div id="leftPanel">
        <!-- æ–°å¢ä¸‹æ‹‰æ¡†ç”¨äºé¡¹ç›®é€‰æ‹© -->
        <div style="display: flex; align-items: center; margin: 10px;">
            <!-- æ·»åŠ è®¾ç½®æŒ‰é’® -->
            <button id="settingsButton" style="margin-left: 10px; padding: 8px; font-size: 14px;">è®¾ç½®</button>
            <select id="projectDropdown" style="margin: 10px; padding: 8px; font-size: 14px;">
                <!-- ä¸‹æ‹‰æ¡†é€‰é¡¹å°†åœ¨JavaScriptä¸­åŠ¨æ€å¡«å…… -->
            </select>
        </div>
        <div class="tapInfo">ğŸ¯ï¼š<a href="https://github.com/Tght1211/CodeMap" style="color:#ffd11b">æ„Ÿè°¢ start</a>â­â­â­
        </div>
        <div class="tapInfo">ğŸ˜€ï¼šå¥åº·ä¾èµ–</div>
        <div class="tapInfo">ğŸ§¨ï¼šå­˜åœ¨å¾ªç¯ä¾èµ–å¾…è§£å†³</div>
        <div class="tapInfo">ğŸœï¼š@Lazyå·²è§£å†³å¾ªç¯ä¾èµ–</div>
        <!-- æ·»åŠ æœç´¢æ¡† -->
        <input style="margin-left: 10px" type="text" id="searchInput" placeholder="æ¨¡ç³Šæœç´¢">
        <div id="leftPanelInner">
            <ul style="padding: 0" id="fileList"></ul>
        </div>
        <div id="dragBar"></div>
    </div>
    <div id="container"></div>
    <div id="settingsModal">
        <div style="padding: 20px;">
            <h2>è®¾ç½®</h2>
            <label for="parameterInput">èŠ‚ç‚¹å€æ•°ï¼š(ç­‰æ¯æ¬¡åº”ç”¨éƒ½åŸºäºå½“å‰å¤§å°æ“ä½œ)</label>
            <input type="number" id="parameterInput" step="0.5" min="0" max="5" style="width: 100%;" placeholder="è¯·å¡«å…¥è°ƒæ•´èŠ‚ç‚¹å¤§å°çš„å€æ•°å€¼å¡«å¦‚ï¼ˆ0.001 ~ 1000)">
            <button id="applySettingsButton" style="margin-top: 10px">åº”ç”¨è®¾ç½®</button>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://cdn.staticfile.org/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript"
        src="https://registry.npmmirror.com/echarts/5.4.3/files/dist/echarts.min.js"></script>

<script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, 'dark', {
        renderer: 'canvas',
        useDirtyRect: false
    });
    var app = {};
    var graphAll; // å°† graph å˜é‡å£°æ˜ä¸ºå…¨å±€å˜é‡
    var option;
    var baseIP = "http://192.168.3.72:15665/"
    var baseUrl = baseIP + 'json/';
    var fileList = $('#fileList');
    var searchInput = $('#searchInput');


    // æ–°å¢ä»£ç ï¼šè·å–é¡¹ç›®æ˜ å°„æ–‡ä»¶ä¸­çš„é¡¹ç›®åˆ—è¡¨ï¼Œå¹¶å¡«å……ä¸‹æ‹‰æ¡†
    var projectDropdown = $('#projectDropdown');


    // è·å–è®¾ç½®æŒ‰é’®å’Œå¼¹çª—å…ƒç´ 
    var settingsButton = $('#settingsButton');
    var settingsModal = $('#settingsModal');
    var applySettingsButton = $('#applySettingsButton');
    var parameterInput = $('#parameterInput');

    // è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    settingsButton.click(function () {
        // æ˜¾ç¤ºå¼¹çª—
        settingsModal.show();
    });

    // æ–°å¢ä»£ç ï¼šåœ¨å¼¹çª—æ˜¾ç¤ºæ—¶ï¼Œåˆå§‹åŒ–å€æ•°å€¼è¾“å…¥æ¡†
    settingsModal.on('show', function () {
        var defaultParameterValue = 1; // è®¾ç½®é»˜è®¤å€¼
        parameterInput.val(defaultParameterValue);
    });

    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œå…³é—­å¼¹çª—
    $(document).on('click', function (event) {
        // æ£€æŸ¥ç‚¹å‡»çš„ç›®æ ‡æ˜¯å¦åœ¨å¼¹çª—å¤–éƒ¨
        if (!settingsModal.is(event.target) && settingsModal.has(event.target).length === 0) {
            // å…³é—­å¼¹çª—
            settingsModal.hide();
        }
    });

    // è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    settingsButton.click(function (event) {
        // æ˜¾ç¤ºå¼¹çª—
        settingsModal.show();
        // é˜»æ­¢äº‹ä»¶å†’æ³¡
        event.stopPropagation();
    });

    // åº”ç”¨è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    applySettingsButton.click(function () {
        // è·å–ç”¨æˆ·è¾“å…¥çš„å‚æ•°å€¼
        var newParameterValue = parameterInput.val();
        // åœ¨è¿™é‡Œå¤„ç†å‚æ•°å€¼ï¼Œæ›´æ–°åˆ°JavaScriptä¸­çš„ç›¸åº”å˜é‡
        updateNodeSize(newParameterValue)
        // éšè—å¼¹çª—
        settingsModal.hide();
    });

    // æ›´æ–°èŠ‚ç‚¹å¤§å°çš„å‡½æ•°
    function updateNodeSize(newSize) {
        console.log('Updating node size with new value:', newSize);
        // åœ¨è¿™é‡Œæ›´æ–°echartsä¸­èŠ‚ç‚¹çš„å¤§å°å±æ€§
        // å‡è®¾ä½ çš„echartsçš„æ•°æ®ç»“æ„æ˜¯å­˜å‚¨åœ¨ graph å˜é‡ä¸­çš„
        graphAll.nodes.forEach(function (node) {
            // åœ¨è¿™é‡Œæ ¹æ®éœ€è¦æ›´æ–°èŠ‚ç‚¹çš„å¤§å°
            node.symbolSize *= newSize;
        });
        console.log('Updated node sizes:', graphAll.nodes.map(node => node.symbolSize));

        // æ›´æ–°echartsçš„å›¾è¡¨
        myChart.setOption({
            series: [{
                data: graphAll.nodes
            }]
        });
    }


    $.get(
        baseUrl, // æ›¿æ¢æˆå®é™…çš„é¡¹ç›®æ˜ å°„æ–‡ä»¶è·¯å¾„
        function (html) {
            // é€šè¿‡ DOMParser è§£æ HTML å­—ç¬¦ä¸²
            var parser = new DOMParser();
            var doc = parser.parseFromString(html, 'text/html');
            // è·å–æ‰€æœ‰çš„ <a> æ ‡ç­¾
            var anchorElements = doc.querySelectorAll('a');
            // éå†æ‰€æœ‰çš„ <a> æ ‡ç­¾å¹¶è¾“å‡ºæ–‡æœ¬ä¿¡æ¯
            anchorElements.forEach(function (element) {
                var fileName = element.innerText
                if (fileName.indexOf("/") !== -1) {
                    // å¡«å……ä¸‹æ‹‰æ¡†é€‰é¡¹
                    projectDropdown.append('<option value="' + baseUrl + fileName + '">' + fileName + '</option>');

                    console.log(element.textContent || element.innerText);
                }
            });
            // æ–°å¢ä¸‹æ‹‰æ¡†é€‰æ‹©äº‹ä»¶ç›‘å¬å™¨
            projectDropdown.change(function () {
                var selectedBaseUrl = $(this).val();
                // æ›´æ–° baseUrl å˜é‡çš„å€¼
                baseUrl = selectedBaseUrl;
                // åˆ·æ–°ä¾§è¾¹çš„æ•°æ®ï¼Œæ–‡ä»¶è·¯å¾„ï¼Œé‡æ–°åŠ è½½æ•°æ®
                refreshFileList();
            });

            // æ‰‹åŠ¨è§¦å‘ä¸‹æ‹‰æ¡†çš„é€‰æ‹©äº‹ä»¶ä»¥åŠ è½½é»˜è®¤é¡¹ç›®æ•°æ®
            projectDropdown.change();
        }
    );


    // å®šä¹‰åˆ·æ–°æ–‡ä»¶åˆ—è¡¨çš„å‡½æ•°
    function refreshFileList() {
        fileList.empty(); // æ¸…ç©ºæ–‡ä»¶åˆ—è¡¨
        // è·å–å¹¶å¡«å……æ–‡ä»¶åˆ—è¡¨
        $.get(
            baseUrl,
            function (html) {
                // é€šè¿‡ DOMParser è§£æ HTML å­—ç¬¦ä¸²
                var parser = new DOMParser();
                var doc = parser.parseFromString(html, 'text/html');
                // è·å–æ‰€æœ‰çš„ <a> æ ‡ç­¾
                var anchorElements = doc.querySelectorAll('a');
                // éå†æ‰€æœ‰çš„ <a> æ ‡ç­¾å¹¶è¾“å‡ºæ–‡æœ¬ä¿¡æ¯
                anchorElements.forEach(function (element) {
                    var fileName = element.innerText
                    if (fileName.indexOf(".json") !== -1) {
                        fileList.append('<li>' + fileName + '</li>');
                        console.log(element.textContent || element.innerText);
                    }
                });

                // æ·»åŠ æœç´¢åŠŸèƒ½
                searchInput.on('input', function () {
                    var searchText = $(this).val().toLowerCase();
                    fileList.find('li').hide().filter(function () {
                        return $(this).text().toLowerCase().includes(searchText);
                    }).show();
                });

                // ä¸ºåˆ—è¡¨é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
                fileList.on('click', 'li', function () {
                    console.log("List item clicked!"); // ç”¨äºè°ƒè¯•çš„æ–°è¡Œ
                    var selectedFile = $(this).text();
                    var url = baseUrl + selectedFile;

                    // ç§»é™¤ä¹‹å‰é€‰ä¸­é¡¹çš„é€‰ä¸­çŠ¶æ€
                    fileList.find('li').removeClass('selected');
                    // æ·»åŠ é€‰ä¸­çŠ¶æ€çš„èƒŒæ™¯é¢œè‰²
                    $(this).addClass('selected');

                    console.log("Selected URL:", url); // ç”¨äºè°ƒè¯•çš„æ–°è¡Œ
                    myChart.showLoading();
                    $.getJSON(
                        url,
                        function (graph) {
                            myChart.hideLoading();
                            graphAll = graph
                            graph.nodes.forEach(function (node) {
                                node.label = {
                                    show: node.symbolSize >= 0
                                };
                            });
                            option = {
                                title: {
                                    text: 'javaBeanä¾èµ–æ³¨å…¥å…³ç³»å›¾',
                                    subtext: 'Default layout',
                                    top: 'bottom',
                                    left: 'right'
                                },
                                tooltip: {},
                                legend: [
                                    {
                                        // selectedMode: 'single',
                                        data: graph.categories.map(function (a) {
                                            return a.name;
                                        })
                                    }
                                ],
                                animationDuration: 15000,
                                animationEasingUpdate: 'quinticInOut',
                                series: [
                                    {
                                        name: 'tght',
                                        type: 'graph',
                                        layout: 'none',
                                        data: graph.nodes,
                                        links: graph.links,
                                        categories: graph.categories,
                                        roam: true,
                                        label: {
                                            position: 'right',
                                            formatter: '{b}'
                                        },
                                        lineStyle: {
                                            color: 'source',
                                            curveness: 0.3
                                        },
                                        edgeSymbol: ['circle', 'arrow'],
                                        edgeSymbolSize: [4, 10],
                                        emphasis: {
                                            focus: 'adjacency',
                                            lineStyle: {
                                                width: 10
                                            }
                                        }
                                    }
                                ]
                            };
                            myChart.setOption(option);
                        }
                    );
                });
                // æ‰‹åŠ¨è§¦å‘ç¬¬ä¸€ä¸ªåˆ—è¡¨é¡¹çš„ç‚¹å‡»äº‹ä»¶
                fileList.find('li:first').click();
            }
        );
    }


    if (option && typeof option === 'object') {
        myChart.setOption(option);
    }

    // æ·»åŠ æ‹–åŠ¨è°ƒæ•´å®½åº¦çš„é€»è¾‘
    var isDragging = false;
    var startX, startWidth;

    $('#dragBar').mousedown(function (e) {
        isDragging = true;
        startX = e.pageX;
        startWidth = $('#leftPanel').width();
        //é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
        e.preventDefault();
        e.stopPropagation();
    });

    $(document).mousemove(function (e) {
        if (isDragging) {
            var newWidth = startWidth + (e.pageX - startX);
            $('#leftPanel').width(newWidth);
            $('#container').width($(window).width() - newWidth);
        }
    });

    $(document).mouseup(function () {
        isDragging = false;
    });

    window.addEventListener('resize', function () {
        myChart.resize();
        // åŠ¨æ€è°ƒæ•´å³ä¾§å®¹å™¨çš„å®½åº¦
        var leftPanelWidth = $('#leftPanel').width();
        $('#container').width($(window).width() - leftPanelWidth);
        $('#dragBar').css('right', 0); // Reset the position of the drag bar
    });
</script>
</body>

</html>

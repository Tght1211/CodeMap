<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta charset="utf-8">
    <style>
        /* æ–°å¢æ ·å¼ï¼Œç”¨äºè®¾ç½®é€‰ä¸­çŠ¶æ€çš„èƒŒæ™¯é¢œè‰² */
        #fileList li.selected {
            background-color: #ff657d; /* é»˜è®¤é€‰ä¸­çŠ¶æ€çš„èƒŒæ™¯é¢œè‰² */
            color: #ffffff; /* é»˜è®¤é€‰ä¸­çŠ¶æ€çš„æ–‡å­—é¢œè‰² */
        }

        /* æ–°å¢æ ·å¼ï¼Œç”¨äºç¾åŒ–æœç´¢æ¡† */
        #searchInput {
            margin: 10px;
            padding: 8px;
            width: 80%;
            font-size: 14px;
            border: 1px solid #555;
            border-radius: 4px;
        }

        /* ç§»é™¤liæ ‡ç­¾å‰é¢çš„å°åœ†ç‚¹ */
        #fileList li {
            list-style-type: none;
            margin: 10px;
            padding: 10px;
        }

        /* æ·»åŠ æ ·å¼ï¼Œä½¿æ»šåŠ¨æ¡éšè— */
        ::-webkit-scrollbar {
            display: none;
        }

        #leftPanel {
            overflow: hidden;
            background: #0f011d;
            color: chartreuse;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Ensure flex items can shrink past their content */
            position: relative;
        }

        #leftPanelInner {
            flex-grow: 1; /* Allow the inner container to grow and fill the available space */
            overflow-y: auto;
        }

        #container {
            flex-grow: 1;
            background: #15012b;
        }

        /* æ·»åŠ æ ·å¼ï¼Œä½¿å·¦ä¾§åˆ—è¡¨å’Œå³ä¾§å®¹å™¨ä¹‹é—´æœ‰ä¸€ä¸ªæ‹–åŠ¨æ¡ */
        #dragBar {
            cursor: ew-resize;
            width: 8px;
            background: #333;
            height: 100%;
            position: absolute;
            right: 0;
            top: 0;
        }
        .tapInfo {
            width: 300px;
            margin-left: 10px;
            padding: 10px;
            color: white;
        }
    </style>
</head>

<body style="height: 100%; margin: 0;padding: 0">
    <div style="display:flex; height: 100vh; width: 100%">
        <div id="leftPanel">
            <div class="tapInfo">ğŸ˜€ï¼šå¥åº·ä¾èµ–</div>
            <div class="tapInfo">ğŸ§¨ï¼šå­˜åœ¨å¾ªç¯ä¾èµ–å¾…è§£å†³</div>
            <div class="tapInfo">ğŸœï¼š@Lazyå·²è§£å†³å¾ªç¯ä¾èµ–</div>
            <!-- æ·»åŠ æœç´¢æ¡† -->
            <input style="margin-left: 10px" type="text" id="searchInput" placeholder="æ¨¡ç³Šæœç´¢">
            <div id="leftPanelInner">
                <ul style="padding: 0" id="fileList"></ul>
            </div>
            <div id="dragBar"></div>
        </div>
        <div id="container"></div>
    </div>

    <script type="text/javascript" src="https://cdn.staticfile.org/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript"
        src="https://registry.npmmirror.com/echarts/5.4.3/files/dist/echarts.min.js"></script>

    <script type="text/javascript">
        var dom = document.getElementById('container');
        var myChart = echarts.init(dom, 'dark', {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var app = {};

        var option;
        var baseUrl = 'http://127.0.0.1:15665/json/';
        var fileList = $('#fileList');
        var searchInput = $('#searchInput');

        // è·å–å¹¶å¡«å……æ–‡ä»¶åˆ—è¡¨
        $.get(
            baseUrl,
            function (html) {
                // é€šè¿‡ DOMParser è§£æ HTML å­—ç¬¦ä¸²
                var parser = new DOMParser();
                var doc = parser.parseFromString(html, 'text/html');
                // è·å–æ‰€æœ‰çš„ <a> æ ‡ç­¾
                var anchorElements = doc.querySelectorAll('a');
                // éå†æ‰€æœ‰çš„ <a> æ ‡ç­¾å¹¶è¾“å‡ºæ–‡æœ¬ä¿¡æ¯
                anchorElements.forEach(function (element) {
                    var fileName = element.innerText
                    fileList.append('<li>' + fileName + '</li>');
                    console.log(element.textContent || element.innerText);
                });

                // æ·»åŠ æœç´¢åŠŸèƒ½
                searchInput.on('input', function () {
                    var searchText = $(this).val().toLowerCase();
                    fileList.find('li').hide().filter(function () {
                        return $(this).text().toLowerCase().includes(searchText);
                    }).show();
                });

                // ä¸ºåˆ—è¡¨é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
                fileList.on('click', 'li', function () {
                    console.log("List item clicked!"); // ç”¨äºè°ƒè¯•çš„æ–°è¡Œ
                    var selectedFile = $(this).text();
                    var url = baseUrl + selectedFile;

                    // ç§»é™¤ä¹‹å‰é€‰ä¸­é¡¹çš„é€‰ä¸­çŠ¶æ€
                    fileList.find('li').removeClass('selected');
                    // æ·»åŠ é€‰ä¸­çŠ¶æ€çš„èƒŒæ™¯é¢œè‰²
                    $(this).addClass('selected');

                    console.log("Selected URL:", url); // ç”¨äºè°ƒè¯•çš„æ–°è¡Œ
                    myChart.showLoading();
                    $.getJSON(
                        url,
                        function (graph) {
                            myChart.hideLoading();
                            graph.nodes.forEach(function (node) {
                                node.label = {
                                    show: node.symbolSize >= 0
                                };
                            });
                            option = {
                                title: {
                                    text: 'javaBeanä¾èµ–æ³¨å…¥å…³ç³»å›¾',
                                    subtext: 'Default layout',
                                    top: 'bottom',
                                    left: 'right'
                                },
                                tooltip: {},
                                legend: [
                                    {
                                        // selectedMode: 'single',
                                        data: graph.categories.map(function (a) {
                                            return a.name;
                                        })
                                    }
                                ],
                                animationDuration: 15000,
                                animationEasingUpdate: 'quinticInOut',
                                series: [
                                    {
                                        name: 'tght',
                                        type: 'graph',
                                        layout: 'none',
                                        data: graph.nodes,
                                        links: graph.links,
                                        categories: graph.categories,
                                        roam: true,
                                        label: {
                                            position: 'right',
                                            formatter: '{b}'
                                        },
                                        lineStyle: {
                                            color: 'source',
                                            curveness: 0.3
                                        },
                                        edgeSymbol: ['circle', 'arrow'],
                                        edgeSymbolSize: [4, 10],
                                        emphasis: {
                                            focus: 'adjacency',
                                            lineStyle: {
                                                width: 10
                                            }
                                        }
                                    }
                                ]
                            };
                            myChart.setOption(option);
                        }
                    );
                });

                // æ‰‹åŠ¨è§¦å‘ç¬¬ä¸€ä¸ªåˆ—è¡¨é¡¹çš„ç‚¹å‡»äº‹ä»¶
                fileList.find('li:first').click();
            }
        );

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }

        // æ·»åŠ æ‹–åŠ¨è°ƒæ•´å®½åº¦çš„é€»è¾‘
        var isDragging = false;
        var startX, startWidth;

        $('#dragBar').mousedown(function (e) {
            isDragging = true;
            startX = e.pageX;
            startWidth = $('#leftPanel').width();
            //é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
            e.preventDefault();
            e.stopPropagation();
        });

        $(document).mousemove(function (e) {
            if (isDragging) {
                var newWidth = startWidth + (e.pageX - startX);
                $('#leftPanel').width(newWidth);
                $('#container').width($(window).width() - newWidth);
            }
        });

        $(document).mouseup(function () {
            isDragging = false;
        });

        window.addEventListener('resize', function () {
            myChart.resize();
            // åŠ¨æ€è°ƒæ•´å³ä¾§å®¹å™¨çš„å®½åº¦
            var leftPanelWidth = $('#leftPanel').width();
            $('#container').width($(window).width() - leftPanelWidth);
            $('#dragBar').css('right', 0); // Reset the position of the drag bar
        });
    </script>
</body>

</html>
